package com.ojas.spring.controller;

import java.io.IOException;

import java.util.List;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.google.gson.Gson;
import com.google.gson.reflect.TypeToken;

import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;
@RestController

public class GitApiRepository {
 	private static final String GitHub_Api_BASEURL="https://api.github.com/";
	@RequestMapping("/getrepo")
	private static List<Repository> getRepository(@RequestBody Users users) throws IOException{
		String username=users.getUsername();
		String accesstoken=users.getToken();
		OkHttpClient client=new OkHttpClient();
		String url=GitHub_Api_BASEURL+"users/"+username+"/repos";
		Request request=new Request.Builder()
		.url(url)
		.header("Authorization", "Bearer"+accesstoken)
		.build();
		Response response=client.newCall(request).execute();
		String responsebody=response.body().string();
		Gson gson=new Gson();
		List <Repository> reposotories=gson.fromJson(responsebody, new TypeToken<List<Repository>>() {}.getType());
		
		
		return reposotories;
		
	}
	
	private static class Repository{
		private String name;
		public  String getName() {
			return name;
		}
	}
	private static class Users{
		private String username;
		private String token;
		public String getUsername() {
			return username;
		}
	
		public String getToken() {
			return token;
		}
		
	}
	

}

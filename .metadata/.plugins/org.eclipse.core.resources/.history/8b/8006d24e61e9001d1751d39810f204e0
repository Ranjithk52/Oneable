package com.ojas.spring.git;

import okhttp3.*;

import okhttp3.*;
import org.json.*;

import java.io.IOException;

public class GitCompareCommits {
    private static final String GITHUB_API_URL = "https://api.github.com/repos/{owner}/{repo}/commits/{sha}";

    private final OkHttpClient client;
    private final String accessToken;

    public GitCompareCommits(String accessToken) {
        this.client = new OkHttpClient();
        this.accessToken = accessToken;
    }

    public  void fetchCommitChanges(String owner, String repo, String sha) throws IOException {
        String url = GITHUB_API_URL.replace("{owner}", owner).replace("{repo}", repo).replace("{sha}", sha);
        Request request = new Request.Builder()
                .url(url)
                .addHeader("Authorization", "Bearer " + accessToken)
                .build();
        Response response = client.newCall(request).execute();
        String json = response.body().string();
        System.out.println();
        JSONObject commit = new JSONObject(json);
        JSONArray files = commit.getJSONArray("files");
        for (int i = 0; i < files.length(); i++) {
            JSONObject file = files.getJSONObject(i);
            String filename = file.getString("filename");
            //JSONArray patch = file.getJSONArray("patch");
            String patch= file.getString("patch");
            //for (int j = 0; j < patch.length(); j++) {
                //String diffLine = patch.getString(j);
                if (patch.startsWith("@@")) {
                    String[] parts = patch.split("\\s+");
                    String[] startLineParts = parts[1].substring(1).split(",");
                    int startLine = Integer.parseInt(startLineParts[0]);
                    int numLines = 1;
                    if (startLineParts.length > 1) {
                        numLines = Integer.parseInt(startLineParts[1]);
                    }
                    System.out.println(patch);
                    System.out.println(filename + " lines " + startLine + "-" + (startLine + numLines - 1));
                }
            //}
            //System.out.println(patch);
        }
    }
    public static void main(String[] args) throws IOException {
    	GitCompareCommits gc=new GitCompareCommits("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");
    	gc.fetchCommitChanges("Ranjithk52", "Practice", "39afac4aa257f58398de8e89f00bdd7f4ec0fa92");
    	
    }
}



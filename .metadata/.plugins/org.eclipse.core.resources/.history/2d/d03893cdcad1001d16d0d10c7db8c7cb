package com.ojas.spring.git;

import java.io.File;
import java.io.IOException;
import java.util.List;

import org.eclipse.jgit.api.Git;
import org.eclipse.jgit.api.ListBranchCommand;
import org.eclipse.jgit.api.errors.GitAPIException;
import org.eclipse.jgit.lib.Ref;

//public class GitBranchLister {
//
//    public static void main(String[] args) throws IOException, GitAPIException {
//        File repoDir = new File("/path/to/your/repository");
//        Git git = Git.open(repoDir);
//
//        List<Ref> branches = git.branchList().setListMode(ListBranchCommand.ListMode.ALL).call();
//
//        for (Ref branch : branches) {
//            System.out.println("Branch: " + branch.getName());
//        }
//
//        git.close();
//    }
//}

import org.eclipse.jgit.api.LsRemoteCommand;
import org.eclipse.jgit.lib.Constants;
import org.eclipse.jgit.transport.UsernamePasswordCredentialsProvider;
import java.util.List;

import org.eclipse.jgit.api.LsRemoteCommand;
import org.eclipse.jgit.lib.Constants;
import org.eclipse.jgit.transport.UsernamePasswordCredentialsProvider;
import java.io.ByteArrayOutputStream;
import java.nio.charset.StandardCharsets;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

public class GitBranchLister {
    public static void main(String[] args) throws Exception {
        // Replace with your GitHub access token
        String accessToken = "your_access_token";

        // Create the LsRemoteCommand for the remote GitHub repository
        LsRemoteCommand lsRemoteCommand = new LsRemoteCommand(null);
        lsRemoteCommand.setRemote("https://github.com/your_username/your_repository.git");
        lsRemoteCommand.setCredentialsProvider(new UsernamePasswordCredentialsProvider(accessToken, ""));
        lsRemoteCommand.setHeads(true);
        lsRemoteCommand.setTags(true);

        // Redirect the output to a ByteArrayOutputStream
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        ((Object) lsRemoteCommand).setOutputStream(outputStream);

        // Execute the command and convert the output to a list of strings
        lsRemoteCommand.call();
        List<String> branches = Arrays.stream(outputStream.toString(StandardCharsets.UTF_8.name()).split("\\r?\\n"))
                .filter(branch -> branch.startsWith(Constants.R_HEADS))
                .map(branch -> branch.substring(Constants.R_HEADS.length()))
                .collect(Collectors.toList());

        // Print the list of branches
        System.out.println(branches);
    }
}
